---
title: "edu-cost"
author: "Jake Weinreb"
date: "5/9/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, error = FALSE, message = FALSE)
```

```{r libraries}
library(tidyverse)
library(janitor)
library(readr)
library(rebus)
```

## Distance Education and Retention Rates

```{r upload}
setwd("/Users/jakeweinreb/Desktop/R/Data/Education/")
institution <- read_csv("institution.csv") %>% clean_names() %>% filter(instcat_hd2017 == 2)
retention_raw <- read_csv("retention.csv") %>% clean_names() %>% select(-x33) %>% 
  filter(unit_id %in% institution$unit_id) %>% 
  gather(key = full_year, value = full, contains("ret_pcf_ef")) %>% 
  gather(key = part_year, value = part, contains("ret_pcp_ef")) %>% 
  gather(key = exclusive_year, value = exclusive, contains("pctdeexc_drvef")) %>% 
  gather(key = some_year, value = some, contains("pctdesom_drvef")) %>% 
  gather(key = none_year, value = none, contains("pctdenon_drvef")) %>% 
  mutate(full_year = str_extract(full_year, one_or_more(DGT)),
         part_year = str_extract(part_year, one_or_more(DGT)),
         exclusive_year = str_extract(exclusive_year, one_or_more(DGT)),
         some_year = str_extract(some_year, one_or_more(DGT)),
         none_year = str_extract(none_year, one_or_more(DGT))) #takes a while (~10 mins)
```

```{r upload}
setwd("/Users/jakeweinreb/Desktop/R/Data/Education/")
institution <- read_csv("institution.csv") %>% clean_names() %>% filter(instcat_hd2017 == 2)
retention_raw <- read_csv("retention.csv") %>% clean_names() %>% select(-x33) %>% 
  filter(unit_id %in% institution$unit_id) %>% 
  gather(key = year, value = full, contains("ret_pcf_ef")) %>% 
  gather(key = part_year, value = part, contains("ret_pcp_ef")) %>% 
  gather(key = exclusive_year, value = exclusive, contains("pctdeexc_drvef")) %>% 
  gather(key = some_year, value = some, contains("pctdesom_drvef")) %>% 
  gather(key = none_year, value = none, contains("pctdenon_drvef")) %>% 
  unique() %>% 
  mutate(full_year = str_extract(full_year, one_or_more(DGT)),
         part_year = str_extract(part_year, one_or_more(DGT)),
         exclusive_year = str_extract(exclusive_year, one_or_more(DGT)),
         some_year = str_extract(some_year, one_or_more(DGT)),
         none_year = str_extract(none_year, one_or_more(DGT))) #takes a while (~10 mins)
```

```{r sample}
retention_sample <- sample_n(retention_raw, 1e6)
```

```{r}
retention_sample %>% ggplot(aes(x = full, y = none, group = full_year)) + geom_point(alpha = .4)
```

